<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Asignaturas</title>
 
  <!-- Bootstrap CSS -->
  <link
     href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
     rel="stylesheet"
  >
  <!-- Bootstrap Icons -->
  <link
     href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
     rel="stylesheet"
  >
</head>

<body class="d-flex flex-column min-vh-100">
 
  <!-- Header -->
  <header class="bg-danger text-white text-center py-3">
    <h1 class="h3"><i class="bi bi-person-circle me-2"></i>Bienvenido al Panel del Estudiante</h1>
  </header>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand" href="#">Men√∫</a>
      <button
         class="navbar-toggler"
         type="button"
         data-bs-toggle="collapse"
         data-bs-target="#navbarNav"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
       
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="panel.html">Panel</a></li>
          <li class="nav-item"><a class="nav-link active" href="asignaturas.html">Asignaturas</a></li>
          <li class="nav-item"><a class="nav-link" href="asignaciones.html">Asignaciones</a></li>
          <li class="nav-item"><a class="nav-link" href="calificaciones.html">Calificaciones</a></li>
          <li class="nav-item"><a class="nav-link" href="index.html">Cerrar sesi√≥n</a></li>
        </ul>
      </div>
    </div>
  </nav>
 
  <!-- Contenido principal con Vue -->
  <div id="app" class="container py-4">
    <div v-if="loading" class="text-center">
      <div class="spinner-border text-danger" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <p>Cargando asignaturas...</p>
    </div>

    <div v-else-if="error" class="alert alert-danger" role="alert">
      <i class="bi bi-exclamation-triangle me-2"></i>{{ error }}
    </div>

    <div v-else>
      <h2 class="mb-3">
        <i class="bi bi-book me-2"></i>
        Asignaturas del grado: <span class="text-danger">{{ grado }}</span>
      </h2>
       
      <div v-if="materias.length > 0" class="row">
        <div v-for="materia in materias" :key="materia" class="col-md-4 col-lg-3 mb-3">
          <div class="card shadow-sm h-100 border-0">
            <div class="card-body text-center d-flex flex-column justify-content-center">
              <i class="bi bi-journal-text text-danger fs-1 mb-3"></i>
              <h5 class="card-title text-dark">{{ materia }}</h5>
              <button class="btn btn-outline-danger btn-sm mt-2">
                <i class="bi bi-arrow-right me-1"></i>Ver detalles
              </button>
            </div>
          </div>
        </div>
      </div>
       
      <div v-else class="text-center py-5">
        <i class="bi bi-journal-x text-muted" style="font-size: 4rem;"></i>
        <p class="text-muted fs-5 mt-3">No hay asignaturas registradas para este curso.</p>
      </div>
    </div>
  </div>
   
  <!-- Footer -->
  <footer class="bg-danger text-white text-center py-3 mt-auto">
    <p class="mb-0">&copy; 2025 Plataforma Escolar Colombo Holand√©s. Todos los derechos reservados.</p>
  </footer>
 
  <!-- Bootstrap JS -->
  <script
     src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js">
  </script>
 
  <!-- Vue.js -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
 
  <!-- Script de Vue -->
  <script>
    const { createApp } = Vue
     
    createApp({
      data() {
        return {
          grado: "",
          materias: [],
          loading: true,
          error: null,
          usuario: null
        }
      },
      async mounted() {
        await this.cargarDatosUsuario();
      },
      methods: {
        async cargarDatosUsuario() {
          try {
            // Obtener datos del usuario desde localStorage (guardados en el login)
            const usuarioData = localStorage.getItem('usuarioLogueado');
            
            if (!usuarioData) {
              this.error = "No hay sesi√≥n activa. Por favor inicia sesi√≥n.";
              this.loading = false;
              // Redirigir al login despu√©s de 2 segundos
              setTimeout(() => {
                window.location.href = 'index.html';
              }, 2000);
              return;
            }

            this.usuario = JSON.parse(usuarioData);
            
            // Verificar que sea un estudiante y tenga grado
            if (this.usuario.rol !== 'estudiante' || !this.usuario.grado) {
              this.error = "Usuario no v√°lido para ver asignaturas.";
              this.loading = false;
              return;
            }

            this.grado = this.usuario.grado;
            
            // Cargar asignaturas del grado
            await this.cargarAsignaturas();
            
          } catch (err) {
            console.error('Error al cargar datos del usuario:', err);
            this.error = "Error al cargar la informaci√≥n del usuario.";
            this.loading = false;
          }
        },
        
        async cargarAsignaturas() {
          try {
            console.log(`üîç Cargando asignaturas para grado: ${this.grado}`);
            const response = await fetch(`http://localhost:3000/asignaturas/${this.grado}`);
            
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const data = await response.json();
            console.log('üìö Respuesta del servidor:', data);
            
            if (data.success) {
              this.materias = data.materias;
              console.log(`‚úÖ Cargadas ${this.materias.length} materias`);
            } else {
              this.materias = [];
              console.log('‚ö†Ô∏è No se encontraron materias');
            }
            
            this.loading = false;
            
          } catch (err) {
            console.error('‚ùå Error al cargar asignaturas:', err);
            this.error = `Error al cargar las asignaturas: ${err.message}`;
            this.loading = false;
          }
        }
      }
    }).mount("#app")
  </script>

</body>
</html>